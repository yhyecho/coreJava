## JDBC (Java Database Connection)
> 为java开发者使用数据库提供了统一的编程接口

> 开发步骤: 加载驱动 -> 连接数据库 -> 发送sql语句 -> 获得结果集 --> 关闭连接

#### Connection接口 (用于建立数据库连接)
> eg:
```java
/**
 * Created by Echo
 * （mysql驱动类加载、建立Connection、效率测试）
 */
public class test01 {

    public static void main(String[] args) {
        try {
            // 1. 加载驱动
            Class.forName("com.mysql.jdbc.Driver");
            long startTime = System.currentTimeMillis();
            // 2. 建立连接
            // 2.1 连接对象内部其实包含了Socket对象, 是一个远程的连接,比较耗时.
            // 2.2 开发过程中使用连接池来管理连接对象
            Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/jdbcTest?useUnicode=true&characterEncoding=UTF-8", "root", "root");

            long endTime = System.currentTimeMillis();
            System.out.println("建立连接,耗时" + (endTime - startTime) + "ms毫秒");
            System.out.println(conn);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

#### Statement接口 (用于执行静态sql语句并返回它所生成结果的对象)
> userinfo.sql (测试表userinfo)
```mysql
CREATE DATABASE IF NOT EXISTS jdbcTest DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
USE jdbcTest;
CREATE TABLE userinfo (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(20),
  age      TINYINT UNSIGNED
) ENGINE = InnoDB
DEFAULT CHARSET utf8;
```
* Statement (sql未预编译,容易引起sql注入)
> eg:
```java
/**
 * Created by Echo
 * Statement接口用法（SQL注入）
 */
public class test02 {

    public static void main(String[] args) {
        try {
            Class.forName("com.mysql.jdbc.Driver");
            Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/jdbcTest?useUnicode=true&characterEncoding=UTF-8", "root", "root");

            Statement stmt = conn.createStatement();

            String sql = "INSERT INTO userinfo (username, age) VALUES ('老王', 18)";
            stmt.execute(sql);
            // 测试SQL注入
            // String id = "5 or 1=1";
            // sql = "DELETE FROM userinfo WHERE id=" + id;
            // stmt.execute(sql);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```
* PreparedStatement (sql语句预编译, 防止sql注入)
> eg:
```java
/**
 * Created by Echo
 * PreparedStatement用法（占位符、参数处理）
 */
public class test03 {

    public static void main(String[] args) {
        try {
            Class.forName("com.mysql.jdbc.Driver");
            Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/jdbcTest?useUnicode=true&characterEncoding=UTF-8", "root", "root");

            String sql = "INSERT INTO userinfo (username, age) VALUES (?, ?)"; // ?占位符
            PreparedStatement ps = conn.prepareStatement(sql);
            ps.setString(1, "老李"); // 参数索引从1开始计算, 而不是0
            ps.setInt(2, 19);
            // ps.setObject(1, "老俞"); 可以使用setObject传参数, 不用考虑数据类型
            // ps.setObject(2, 66);

            System.out.println("插入一行记录");
            ps.execute();

        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```
#### ResultSet接口
> eg: ResultSet结果集用法（游标原理、关闭连接）
```java
/**
 * Created by Echo
 * ResultSet结果集用法（游标原理、关闭连接）
 */
public class test04 {

    public static void main(String[] args) {
        Connection conn = null;
        PreparedStatement ps = null;
        ResultSet resultSet = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/jdbcTest?useUnicode=true&characterEncoding=UTF-8", "root", "root");

            String sql = "SELECT id, username FROM userinfo WHERE id > ?";
            ps = conn.prepareStatement(sql);

            ps.setObject(1, 2); // 返回id大于2的
            // 返回结果集
            resultSet = ps.executeQuery();

            while (resultSet.next()) { // 移动游标 判断是否有下一个
                // 打印结果集
                System.out.println(resultSet.getInt(1) + "---" + resultSet.getString(2));
            }

        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            // 关闭连接, 后开的先关
            if (resultSet != null) {
                try {
                    resultSet.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
            if (ps != null) {
                try {
                    ps.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
            if (conn != null) {
                try {
                    conn.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
```
#### JDBC中的批处理
> 使用批处理Batch插入2万条数据 (1. 设置事务手动提交) 2. 尽量使用Statement [prepareStatement预编译空间的问题可能会出问题]

```java
/**
 * Created by Echo
 * 使用批处理Batch（测试插入2万条数据）
 */
public class test05 {

    public static void main(String[] args) {
        Connection conn = null;
        Statement stmt = null;
        ResultSet resultSet = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/jdbcTest?useUnicode=true&characterEncoding=UTF-8", "root", "root");

            // 1. 设置事务手动提交
            conn.setAutoCommit(false);
            long startTime = System.currentTimeMillis();
            // 2. 尽量使用Statement (prepareStatement预编译空间的问题可能会出问题)
            stmt = conn.createStatement();
            // 一次性插入两万条数据
            for (int i = 0; i < 20000; i++) {
                stmt.addBatch("INSERT INTO userinfo (username, age) VALUES ('yu" + i +"', 18)");
            }

            stmt.executeBatch();
            // 提交事务
            conn.commit();
            long endTime = System.currentTimeMillis();

            System.out.println("插入两万条数据, 耗时: " + (endTime - startTime) + " ms毫秒");
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            // 关闭连接, 后开的先关
            if (resultSet != null) {
                try {
                    resultSet.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
            if (stmt != null) {
                try {
                    stmt.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
            if (conn != null) {
                try {
                    conn.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
```

#### 事务 (一组要么同时执行成功,要么同时执行失败的sql语句.是数据库操作的一个执行单元)
* CallableStatement
